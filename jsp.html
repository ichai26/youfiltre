<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouFiltre - Plateforme vidéo avec contenu modéré</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
  <style>
    .video-card:hover { transform: translateY(-5px); transition: transform 0.2s ease; }
    .sidebar-item:hover { background-color: rgba(229, 231, 235, 0.5); }
    .video-player-container { aspect-ratio: 16 / 9; background-color: #000; }
    .custom-scrollbar::-webkit-scrollbar { width: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
    .architecture-diagram { background-image: radial-gradient(#f9fafb 1px, transparent 1px); background-size: 20px 20px; }
    .link { cursor: pointer; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Navigation -->
  <header class="bg-white shadow-md fixed w-full top-0 z-50">
    <div class="flex items-center justify-between px-4 py-2 max-w-7xl mx-auto">
      <!-- Logo & Burger Menu -->
      <div class="flex items-center">
        <button id="btn-burger" class="p-2 mr-2 rounded-full hover:bg-gray-200" aria-label="Ouvrir le menu">
          <i class="fas fa-bars text-gray-700"></i>
        </button>
        <a href="#/home" class="flex items-center link" aria-label="Aller à l'accueil">
          <span class="text-red-600 font-bold text-2xl">You</span><span class="text-blue-600 font-bold text-2xl">Filtre</span>
          <span class="text-xs bg-blue-100 text-blue-800 px-1 rounded ml-1">Sécurisé</span>
        </a>
      </div>

      <!-- Search Bar -->
      <div class="hidden md:flex items-center flex-1 max-w-2xl mx-4">
        <form id="search-form" class="relative w-full">
          <label class="sr-only" for="search-input">Rechercher</label>
          <input id="search-input" type="search" placeholder="Rechercher une vidéo des chaînes approuvées" class="w-full px-4 py-2 border border-gray-300 rounded-l-full focus:outline-none focus:border-blue-500" />
          <button type="submit" class="absolute right-0 top-0 h-full px-5 bg-gray-100 rounded-r-full border border-l-0 border-gray-300" aria-label="Rechercher">
            <i class="fas fa-search text-gray-600"></i>
          </button>
        </form>
      </div>

      <!-- Right Menu -->
      <div class="flex items-center space-x-3">
        <button id="btn-upload" class="p-2 rounded-full hover:bg-gray-200 md:inline-block hidden" title="Importer">
          <i class="fas fa-video text-gray-700"></i>
        </button>
        <button id="btn-bell" class="p-2 rounded-full hover:bg-gray-200 md:inline-block hidden" title="Notifications">
          <i class="fas fa-bell text-gray-700"></i>
        </button>
        <button id="btn-login" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
          <i class="fas fa-user-circle mr-1"></i>
          <span class="js-login-label">Connexion</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Container -->
  <div class="flex pt-14">
    <!-- Sidebar -->
    <aside class="fixed left-0 h-full bg-white w-64 shadow-md hidden lg:block custom-scrollbar overflow-y-auto z-40">
      <div class="py-4">
        <div class="px-4 py-2 font-medium text-lg border-b border-gray-200">Navigation</div>
        <nav class="mt-2">
          <a href="#/home" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-home mr-4 text-gray-600"></i> Accueil
          </a>
          <a href="#/trending" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-fire mr-4 text-gray-600"></i> Tendances
          </a>
          <a href="#/approved" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-check-circle mr-4 text-blue-600"></i> Chaînes approuvées
          </a>
          <a href="#/history" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-history mr-4 text-gray-600"></i> Historique
          </a>
        </nav>

        <div class="px-4 py-2 mt-4 font-medium text-lg border-b border-gray-200">Abonnements approuvés</div>
        <div class="mt-2">
          <a href="#/channel/education-positive" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white mr-4">E</div>
            Éducation Positive
          </a>
          <a href="#/channel/science-ethique" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center text-white mr-4">S</div>
            Science Éthique
          </a>
          <a href="#/channel/valeurs-societe" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <div class="w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center text-white mr-4">V</div>
            Valeurs & Société
          </a>
          <a href="#/channel/histoire-inspirante" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <div class="w-6 h-6 bg-red-500 rounded-full flex items-center justify-center text-white mr-4">H</div>
            Histoire Inspirante
          </a>
        </div>

        <div class="px-4 py-2 mt-4 font-medium text-lg border-b border-gray-200">Plus d'options</div>
        <div class="mt-2">
          <a href="#/settings" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-cog mr-4 text-gray-600"></i> Paramètres
          </a>
          <a href="#/help" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-question-circle mr-4 text-gray-600"></i> Aide
          </a>
          <a href="#/report" class="flex items-center px-4 py-2 text-gray-800 sidebar-item">
            <i class="fas fa-flag mr-4 text-gray-600"></i> Signaler un contenu
          </a>
          <a href="#/architecture" class="flex items-center px-4 py-2 text-blue-600 sidebar-item">
            <i class="fas fa-code mr-4"></i> Architecture technique
          </a>
        </div>
      </div>
    </aside>

    <!-- Mobile Sidebar Toggle Button -->
    <div class="fixed bottom-5 left-5 z-50 lg:hidden">
      <button id="mobile-sidebar-toggle" class="bg-white p-3 rounded-full shadow-lg" aria-controls="mobile-sidebar" aria-expanded="false">
        <i class="fas fa-bars text-gray-700"></i>
      </button>
    </div>

    <!-- Mobile Sidebar (Hidden by default) -->
    <div id="mobile-sidebar" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden lg:hidden" aria-hidden="true">
      <div class="absolute left-0 top-0 h-full w-64 bg-white shadow-md transform -translate-x-full transition-transform duration-300 ease-in-out" id="mobile-sidebar-content">
        <!-- Copié dynamiquement ci-dessous -->
      </div>
    </div>

    <!-- Main Content -->
    <main id="app" class="flex-1 min-h-screen ml-0 lg:ml-64 p-6 max-w-7xl mx-auto"></main>
  </div>

  <!-- Footer -->
  <footer class="bg-white shadow-md py-6 mt-10">
    <div class="container mx-auto px-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <a href="#/home" class="flex items-center link">
            <span class="text-red-600 font-bold text-xl">You</span><span class="text-blue-600 font-bold text-xl">Filtre</span>
          </a>
          <p class="text-gray-600 text-sm mt-1">Vidéos approuvées pour un contenu respectueux des valeurs</p>
        </div>
        <div class="flex flex-wrap justify-center gap-4">
          <a href="#/about" class="text-gray-700 hover:text-blue-600">À propos</a>
          <a href="#/privacy" class="text-gray-700 hover:text-blue-600">Confidentialité</a>
          <a href="#/terms" class="text-gray-700 hover:text-blue-600">Conditions d'utilisation</a>
          <a href="#/contact" class="text-gray-700 hover:text-blue-600">Contact</a>
        </div>
      </div>
      <div class="mt-6 text-center text-gray-500 text-sm">
        <p>Cette plateforme utilise l'API YouTube mais n'est pas affiliée à YouTube ou Google Inc.</p>
        <p class="mt-1">© <span id="year"></span> YouFiltre - Tous droits réservés</p>
      </div>
    </div>
  </footer>

  <template id="tpl-home">
    <section class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h1 class="text-2xl font-bold mb-4">Bienvenue sur YouFiltre</h1>
      <p class="text-gray-700 mb-4">Profitez d'une expérience type YouTube, mais avec un contenu soigneusement sélectionné qui respecte des valeurs morales spécifiques.</p>
      <div class="flex space-x-4">
        <a href="#/signup" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 link"><i class="fas fa-sign-in-alt mr-2"></i>Créer un compte</a>
        <a href="#/about" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-md hover:bg-gray-300 link"><i class="fas fa-info-circle mr-2"></i>En savoir plus</a>
      </div>
    </section>

    <h2 class="text-xl font-semibold mb-4">Vidéos recommandées</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-10" id="grid-videos"></div>

    <section class="bg-blue-50 p-6 rounded-lg shadow-md mb-10 border border-blue-200">
      <h2 class="text-xl font-semibold mb-4 text-blue-800">Suggérer une chaîne à ajouter</h2>
      <p class="text-gray-700 mb-4">Vous connaissez une chaîne YouTube de qualité ? Proposez-la pour évaluation.</p>
      <form id="suggest-form" class="mt-4 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-gray-700 text-sm font-medium mb-2" for="channel-name">Nom de la chaîne</label>
            <input required type="text" id="channel-name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nom de la chaîne YouTube" />
          </div>
          <div>
            <label class="block text-gray-700 text-sm font-medium mb-2" for="channel-url">URL de la chaîne</label>
            <input required type="url" id="channel-url" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://youtube.com/@..." />
          </div>
        </div>
        <div>
          <label class="block text-gray-700 text-sm font-medium mb-2" for="channel-reason">Pourquoi ?</label>
          <textarea required id="channel-reason" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Expliquez pourquoi cette chaîne correspond à nos valeurs..."></textarea>
        </div>
        <div class="flex justify-end gap-2">
          <button type="reset" class="px-4 py-2 rounded-md bg-gray-100">Réinitialiser</button>
          <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700"><i class="fas fa-paper-plane mr-2"></i>Soumettre</button>
        </div>
        <p id="suggest-feedback" class="text-sm"></p>
      </form>
    </section>

    <section class="bg-white p-6 rounded-lg shadow-md mb-10">
      <h2 class="text-xl font-semibold mb-4">Tableau de bord administrateur (aperçu)</h2>
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-lg font-medium">Gestion des chaînes et du contenu</h3>
        <div class="flex space-x-2">
          <button id="btn-add-channel" class="bg-green-600 text-white px-4 py-2 rounded-md text-sm"><i class="fas fa-plus mr-1"></i>Ajouter une chaîne</button>
          <button id="btn-sync" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm"><i class="fas fa-sync-alt mr-1"></i>Synchroniser</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200" id="admin-table"></table>
      </div>
    </section>
  </template>

  <template id="tpl-watch">
    <div class="bg-white p-6 rounded-lg shadow-md mb-10">
      <div class="flex flex-col lg:flex-row gap-6">
        <div class="lg:w-2/3">
          <div class="video-player-container rounded-lg overflow-hidden">
            <video controls playsinline webkit-playsinline class="w-full h-full object-cover js-video">
              <!-- src injecté via JS -->
            </video>
          </div>
          <div class="mt-4">
            <h1 class="text-xl font-semibold js-title">Titre</h1>
            <div class="flex justify-between items-center mt-2">
              <p class="text-gray-600 js-meta">—</p>
              <div class="flex space-x-4">
                <button class="flex items-center text-gray-700 js-like"><i class="fas fa-thumbs-up mr-1"></i><span class="js-like-count">0</span></button>
                <button class="flex items-center text-gray-700 js-dislike"><i class="fas fa-thumbs-down mr-1"></i><span class="js-dislike-count">0</span></button>
                <button class="flex items-center text-gray-700 js-share"><i class="fas fa-share mr-1"></i><span>Partager</span></button>
              </div>
            </div>
            <div class="flex items-center mt-4 pb-4 border-b border-gray-200">
              <div class="w-12 h-12 rounded-full bg-purple-400 mr-3"></div>
              <div>
                <h4 class="font-medium js-channel">Chaîne</h4>
                <p class="text-gray-600 text-sm js-subs">— abonnés</p>
              </div>
              <button class="ml-auto bg-red-600 text-white px-4 py-2 rounded-md js-subscribe">S'abonner</button>
            </div>
            <div class="mt-4">
              <h4 class="font-medium mb-2">Description:</h4>
              <p class="text-gray-700 js-desc"></p>
            </div>
          </div>

          <div class="mt-6">
            <h4 class="font-medium mb-4 js-comments-count">0 commentaire</h4>
            <div class="flex mb-4">
              <div class="w-10 h-10 rounded-full bg-blue-300 mr-3"></div>
              <div class="flex-1">
                <form id="comment-form" class="flex gap-2">
                  <input required name="comment" type="text" placeholder="Ajouter un commentaire..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                  <button type="submit" class="px-4 py-2 rounded-md bg-blue-600 text-white">Envoyer</button>
                </form>
              </div>
            </div>
            <div class="space-y-4 js-comments"></div>
          </div>
        </div>

        <aside class="lg:w-1/3">
          <h4 class="font-medium mb-3">Vidéos recommandées</h4>
          <div class="space-y-3 js-related"></div>
        </aside>
      </div>
    </div>
  </template>

  <template id="tpl-generic">
    <section class="bg-white p-8 rounded-lg shadow-md">
      <h1 class="text-2xl font-bold mb-2 js-title"></h1>
      <p class="text-gray-700 js-content"></p>
    </section>
  </template>

  <script>
    /* ----------------------------- Données mock ---------------------------- */
    const db = {
      user: { loggedIn: false, name: "Invité" },
      channels: [
        { id: "education-positive", name: "Éducation Positive", slug: "education-positive", category: "Éducation", videos: 127, status: "Actif" },
        { id: "science-ethique", name: "Science Éthique", slug: "science-ethique", category: "Science", videos: 89, status: "Actif" },
        { id: "valeurs-societe", name: "Valeurs & Société", slug: "valeurs-societe", category: "Société", videos: 112, status: "Actif" },
        { id: "histoire-inspirante", name: "Histoire Inspirante", slug: "histoire-inspirante", category: "Histoire", videos: 76, status: "Actif" },
      ],
      videos: [
        {
          id: "v1",
          title: "L'importance de l'éthique dans les nouvelles technologies",
          channel: "Science Éthique",
          channelSlug: "science-ethique",
          views: 125000,
          timeAgo: "il y a 2 jours",
          likes: 15000,
          dislikes: 125,
          subs: "1.2M",
          desc: "Exploration des impacts éthiques des technologies émergentes.",
          poster: "https://via.placeholder.com/1280x720.png?text=Video",
          src: "",
        },
        {
          id: "v2",
          title: "Histoire inspirante : Comment ces jeunes ont aidé leur communauté",
          channel: "Histoire Inspirante",
          channelSlug: "histoire-inspirante",
          views: 83000,
          timeAgo: "il y a 5 jours",
          likes: 8200,
          dislikes: 50,
          subs: "842K",
          desc: "Un regard sur des initiatives solidaires locales.",
          poster: "https://via.placeholder.com/1280x720.png?text=Histoire",
          src: "",
        },
        {
          id: "v3",
          title: "Apprendre le respect des autres cultures : un guide",
          channel: "Valeurs & Société",
          channelSlug: "valeurs-societe",
          views: 57000,
          timeAgo: "il y a 1 semaine",
          likes: 5400,
          dislikes: 30,
          subs: "1.2M",
          desc: "Comprendre et respecter les différences culturelles.",
          poster: "https://via.placeholder.com/1280x720.png?text=Valeurs+%26+Soci%C3%A9t%C3%A9",
          src: "",
        },
        {
          id: "v4",
          title: "Méthodes d'éducation positive pour les enfants de tous âges",
          channel: "Éducation Positive",
          channelSlug: "education-positive",
          views: 92000,
          timeAgo: "il y a 3 jours",
          likes: 9800,
          dislikes: 70,
          subs: "654K",
          desc: "Des pratiques concrètes pour une éducation bienveillante.",
          poster: "https://via.placeholder.com/1280x720.png?text=%C3%89ducation+Positive",
          src: "",
        },
      ],
      comments: {
        v1: [ { author: "Marie D.", ago: "il y a 3 jours", text: "J'ai beaucoup appris !", likes: 42 }, { author: "Thomas B.", ago: "il y a 5 jours", text: "Plateforme géniale, merci !", likes: 78 } ],
        v2: [], v3: [], v4: []
      },
      history: [],
      suggestions: [],
    };

    /* ------------------------------- Utilitaires ------------------------------ */
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const formatViews = n => new Intl.NumberFormat('fr-FR').format(n) + ' vues';

    function setYear(){ $('#year').textContent = new Date().getFullYear(); }

    function flash(el, type = 'success', text = '') {
      el.className = `mt-2 text-sm ${type === 'success' ? 'text-green-700' : 'text-red-700'}`;
      el.textContent = text;
      setTimeout(() => { el.textContent = ''; }, 3500);
    }

    /* ------------------------------ Rendu Home ------------------------------ */
    function renderHome() {
      const app = $('#app');
      app.innerHTML = $('#tpl-home').innerHTML;

      // Grille vidéos
      const grid = $('#grid-videos');
      db.videos.forEach(v => {
        const card = document.createElement('article');
        card.className = 'bg-white rounded-lg shadow-md overflow-hidden video-card transition-all';
        card.innerHTML = `
          <a href="#/watch/${v.id}" class="block">
            <div class="video-player-container">
              <img alt="miniature" src="${v.poster}" class="w-full h-full object-cover" />
            </div>
          </a>
          <div class="p-3">
            <div class="flex">
              <div class="w-9 h-9 rounded-full bg-gray-300 mr-3"></div>
              <div>
                <a href="#/watch/${v.id}" class="font-medium text-gray-900 line-clamp-2 hover:text-blue-600">${v.title}</a>
                <p class="text-gray-600 text-sm mt-1">${v.channel}</p>
                <p class="text-gray-500 text-xs mt-1">${formatViews(v.views)} • ${v.timeAgo}</p>
              </div>
            </div>
            <div class="mt-2 flex justify-end">
              <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Approuvé</span>
            </div>
          </div>`;
        grid.appendChild(card);
      });

      // Admin table
      const table = $('#admin-table');
      table.innerHTML = `
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Chaîne</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Catégorie</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vidéos</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          ${db.channels.map(c => `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-300"></div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">${c.name}</div>
                    <div class="text-sm text-gray-500">${c.slug}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${c.category}</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.videos}</td>
              <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${c.status}</span></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button data-action="editChannel" data-id="${c.id}" class="text-blue-600 hover:text-blue-900 mr-3">Éditer</button>
                <button data-action="suspendChannel" data-id="${c.id}" class="text-red-600 hover:text-red-900">Suspendre</button>
              </td>
            </tr>
          `).join('')}
        </tbody>`;

      // Boutons admin
      $('#btn-add-channel').addEventListener('click', () => alert('Formulaire d\'ajout de chaîne (démo).'));
      $('#btn-sync').addEventListener('click', () => alert('Synchronisation (démo).'));
      table.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const id = btn.dataset.id;
        if (btn.dataset.action === 'editChannel') alert('Éditer : ' + id);
        if (btn.dataset.action === 'suspendChannel') alert('Suspendre : ' + id);
      });

      // Suggestion de chaîne
      const suggestForm = $('#suggest-form');
      const feedback = $('#suggest-feedback');
      suggestForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = $('#channel-name').value.trim();
        const url = $('#channel-url').value.trim();
        const reason = $('#channel-reason').value.trim();
        db.suggestions.push({ name, url, reason, by: db.user.name || 'invité' });
        suggestForm.reset();
        flash(feedback, 'success', 'Merci ! Votre suggestion a été transmise à la modération.');
      });
    }

    /* ----------------------------- Rendu Watch ----------------------------- */
    function renderWatch(id) {
      const v = db.videos.find(x => x.id === id);
      if (!v) return renderGeneric('Vidéo introuvable', "La vidéo demandée n'existe pas ou a été retirée.");

      const app = $('#app');
      app.innerHTML = $('#tpl-watch').innerHTML;

      $('.js-title').textContent = v.title;
      $('.js-meta').textContent = `${formatViews(v.views)} • ${v.timeAgo}`;
      $('.js-channel').textContent = v.channel;
      $('.js-subs').textContent = `${v.subs} d'abonnés`;
      $('.js-desc').textContent = v.desc;
      const video = $('.js-video');
      if (v.poster) video.setAttribute('poster', v.poster);
      if (v.src) { const source = document.createElement('source'); source.src = v.src; source.type = 'video/mp4'; video.appendChild(source); }

      // Actions
      const likeBtn = $('.js-like');
      const dislikeBtn = $('.js-dislike');
      const likeCount = $('.js-like-count');
      const dislikeCount = $('.js-dislike-count');
      likeCount.textContent = v.likes;
      dislikeCount.textContent = v.dislikes;

      likeBtn.addEventListener('click', () => { v.likes++; likeCount.textContent = v.likes; });
      dislikeBtn.addEventListener('click', () => { v.dislikes++; dislikeCount.textContent = v.dislikes; });
      $('.js-share').addEventListener('click', async () => {
        const url = location.href;
        try {
          await navigator.clipboard.writeText(url);
          alert('Lien copié dans le presse-papier !');
        } catch {
          prompt('Copiez ce lien :', url);
        }
      });
      $('.js-subscribe').addEventListener('click', (e) => {
        e.currentTarget.disabled = true;
        e.currentTarget.textContent = 'Abonné ✔';
      });

      // Historique
      db.history.unshift({ id: v.id, title: v.title, channel: v.channel, at: new Date().toISOString() });
      db.history = db.history.slice(0, 30);

      // Commentaires
      const list = $('.js-comments');
      const header = $('.js-comments-count');
      function refreshComments() {
        const comments = db.comments[v.id] || [];
        header.textContent = `${comments.length} commentaire${comments.length > 1 ? 's' : ''}`;
        list.innerHTML = comments.map(c => `
          <div class="flex pb-4 border-b border-gray-100">
            <div class="w-10 h-10 rounded-full bg-green-300 mr-3"></div>
            <div>
              <div class="flex items-center">
                <h5 class="font-medium">${c.author}</h5>
                <span class="text-gray-500 text-sm ml-2">${c.ago}</span>
              </div>
              <p class="text-gray-800 mt-1">${c.text}</p>
              <div class="flex items-center mt-2 text-gray-600 text-sm">
                <button class="flex items-center mr-4"><i class="fas fa-thumbs-up mr-1"></i><span>${c.likes}</span></button>
                <button class="flex items-center mr-4"><i class="fas fa-thumbs-down mr-1"></i></button>
                <button>Répondre</button>
              </div>
            </div>
          </div>`).join('');
      }
      refreshComments();
      $('#comment-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const text = new FormData(e.target).get('comment').toString().trim();
        if (!text) return;
        (db.comments[v.id] ||= []).unshift({ author: db.user.name || 'Invité', ago: 'à l\'instant', text, likes: 0 });
        e.target.reset();
        refreshComments();
      });

      // Recommandations
      const related = $('.js-related');
      db.videos.filter(x => x.id !== v.id).forEach(x => {
        const item = document.createElement('div');
        item.className = 'flex group';
        item.innerHTML = `
          <a href="#/watch/${x.id}" class="w-40 h-20 bg-gray-200 rounded-lg mr-2 flex-shrink-0 overflow-hidden block">
            <img src="${x.poster}" alt="Miniature vidéo" class="w-full h-full object-cover" />
          </a>
          <div>
            <a href="#/watch/${x.id}" class="text-sm font-medium text-gray-900 line-clamp-2 group-hover:text-blue-600">${x.title}</a>
            <p class="text-xs text-gray-600 mt-1">${x.channel}</p>
            <p class="text-xs text-gray-500">${formatViews(x.views)} • ${x.timeAgo}</p>
          </div>`;
        related.appendChild(item);
      });
    }

    /* ------------------------------- Pages misc ------------------------------ */
    function renderGeneric(title, content) {
      const app = $('#app');
      app.innerHTML = $('#tpl-generic').innerHTML;
      $('.js-title').textContent = title;
      $('.js-content').textContent = content;
    }

    function renderList(title, items) {
      const app = $('#app');
      app.innerHTML = `<section class="bg-white p-6 rounded-lg shadow-md">
        <h1 class="text-2xl font-semibold mb-4">${title}</h1>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">${items.map(v => `
          <article class="bg-white rounded-lg shadow-md overflow-hidden video-card">
            <a href="#/watch/${v.id}" class="block"><img src="${v.poster}" class="w-full h-40 object-cover" alt="${v.title}" /></a>
            <div class="p-3">
              <a href="#/watch/${v.id}" class="font-medium hover:text-blue-600">${v.title}</a>
              <p class="text-sm text-gray-600">${v.channel}</p>
              <p class="text-xs text-gray-500">${formatViews(v.views)} • ${v.timeAgo}</p>
            </div>
          </article>`).join('')}</div>
      </section>`;
    }

    /* --------------------------------- Router -------------------------------- */
    const routes = {
      '#/home': () => renderHome(),
      '#/trending': () => renderList('Tendances', [...db.videos].sort((a,b)=>b.views-a.views)),
      '#/approved': () => renderGeneric('Chaînes approuvées', 'Liste des chaînes validées par la modération.'),
      '#/history': () => renderList('Historique', db.history.map(h => db.videos.find(v=>v.id===h.id)).filter(Boolean)),
      '#/settings': () => renderGeneric('Paramètres', 'Personnalisez votre expérience.'),
      '#/help': () => renderGeneric('Aide', 'FAQ, support et ressources.'),
      '#/report': () => renderGeneric('Signaler', 'Décrivez le contenu à signaler.'),
      '#/architecture': () => renderGeneric('Architecture technique', 'Schémas et considérations techniques.'),
      '#/about': () => renderGeneric('À propos', 'YouFiltre : vision et équipe.'),
      '#/privacy': () => renderGeneric('Confidentialité', 'Politique de confidentialité.'),
      '#/terms': () => renderGeneric('Conditions d\'utilisation', 'Conditions de service.'),
      '#/contact': () => renderGeneric('Contact', 'contact@youfiltre.example'),
      '#/signup': () => renderGeneric('Créer un compte', 'Formulaire d\'inscription (démo).'),
    };

    function navigate() {
      // Route dynamique watch & channel
      const hash = location.hash || '#/home';
      if (hash.startsWith('#/watch/')) {
        const id = hash.split('/')[2];
        renderWatch(id);
        return;
      }
      if (hash.startsWith('#/channel/')) {
        const slug = hash.split('/')[2];
        const vids = db.videos.filter(v => v.channelSlug === slug);
        renderList('Chaîne — ' + (vids[0]?.channel || slug), vids);
        return;
      }
      (routes[hash] || routes['#/home'])();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.addEventListener('hashchange', navigate);

    /* ---------------------------- Barre de recherche --------------------------- */
    $('#search-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const q = $('#search-input').value.toLowerCase().trim();
      const results = db.videos.filter(v => v.title.toLowerCase().includes(q) || v.channel.toLowerCase().includes(q));
      renderList(`Résultats pour "${q}"`, results);
      if (!results.length) renderGeneric('Aucun résultat', `Aucune vidéo trouvée pour "${q}".`);
    });

    /* ------------------------ Entête : actions globales ----------------------- */
    $('#btn-burger').addEventListener('click', () => toggleMobileSidebar(true));
    $('#btn-upload').addEventListener('click', () => alert('Uploader (démo).'));
    $('#btn-bell').addEventListener('click', () => alert('Notifications (démo).'));
    $('#btn-login').addEventListener('click', () => {
      db.user.loggedIn = !db.user.loggedIn;
      db.user.name = db.user.loggedIn ? 'Ichai' : 'Invité';
      $$('.js-login-label').forEach(el => el.textContent = db.user.loggedIn ? 'Déconnexion' : 'Connexion');
      alert(db.user.loggedIn ? 'Bienvenue, Ichai !' : 'Vous êtes déconnecté.');
    });

    /* ----------------------------- Sidebar mobile ---------------------------- */
    const desktopAsideHTML = document.querySelector('aside').innerHTML;
    $('#mobile-sidebar-content').innerHTML = desktopAsideHTML;

    function toggleMobileSidebar(open) {
      const overlay = $('#mobile-sidebar');
      const panel = $('#mobile-sidebar-content');
      if (open) {
        overlay.classList.remove('hidden');
        panel.style.transform = 'translateX(0)';
        $('#mobile-sidebar-toggle').setAttribute('aria-expanded', 'true');
      } else {
        overlay.classList.add('hidden');
        panel.style.transform = 'translateX(-100%)';
        $('#mobile-sidebar-toggle').setAttribute('aria-expanded', 'false');
      }
    }

    $('#mobile-sidebar-toggle').addEventListener('click', () => toggleMobileSidebar(true));
    $('#mobile-sidebar').addEventListener('click', (e) => { if (e.target.id === 'mobile-sidebar') toggleMobileSidebar(false); });
    // Fermer le menu après clic sur un lien
    $('#mobile-sidebar-content').addEventListener('click', (e) => { if (e.target.tagName === 'A') toggleMobileSidebar(false); });

    /* --------------------------------- Init ---------------------------------- */
    setYear();
    navigate();
  </script>
</body>
</html>
